rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ‘¤ USER ROOT: Each user can read/write/delete their own account
    match /users/{userId} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;

      // ğŸ”§ Subcollections like preferences, billing history, journal entries
      match /{document=**} {
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }

      // ğŸ“ Encrypted journal entries (new subcollection)
      match /journal/{entryId} {
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }
    }

    // ğŸ—‚ï¸ Legacy top-level journals collection (optional â€” remove if not used)
    match /journals/{userId} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;

      match /{entryId} {
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }
    }

    // ğŸ’¬ Chats or mood logs (similar structure to journals)
    match /chats/{userId} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;

      match /{chatId} {
        allow read, write, delete: if request.auth != null && request.auth.uid == userId;
      }
    }

    // ğŸ’³ Billing metadata (DO NOT store card data here)
    match /billing/{userId} {
      allow read, write, delete: if request.auth != null && request.auth.uid == userId;
    }

    // âš™ï¸ Admin configuration documents (restricted to admin accounts)
    match /admin/{docId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}
